# 📄 書籍搜尋系統 - 功能需求文件 (Book Search Requirements)

這份文件定義了宜蘭大學二手書交易平台中，關於書籍搜尋、過濾、排序和結果呈現的功能和非功能性需求。
---
## 0. 系統說明 (System Overview)

書籍搜尋系統是平台的核心組件，專門處理買家（學弟）的檢索請求，以確保他們能在**短時間內找到目標書籍**，並根據課程、老師等多維度資訊進行篩選和排序。

* **主要目標：** 提供高效、精確、多樣化的書籍檢索服務。
* **使用者：** 平台所有註冊用戶（買家）。
* **功能涵蓋：** 支援多維度關鍵字查詢、結果篩選、排序和加權計分。
---
## 1. 💻 初步系統架構 (Preliminary System Architecture)

為了滿足搜尋速度（效能）和複雜查詢的需求，我們計劃採用**專用搜尋引擎**來處理檢索任務。

* **核心組件：**
    * **應用程式服務器 (Application Server):** 處理 API 請求、業務邏輯和結果格式化。
    * **主資料庫 (Primary Database):** 儲存書籍的詳細、交易、使用者等**主要資料**。
    * **專用搜尋引擎 (Dedicated Search Engine):** 建議採用 **Elasticsearch** 或 **Solr**，專門用於建立書籍的全文索引，處理複雜查詢和加權計分。

* **資料同步流程：** 當書籍資訊（如刊登、價格、狀態）發生變動時，系統必須將資料同步推送到專用搜尋引擎，以確保搜尋結果的即時性。
---
## 2. 📖 功能性需求 (Functional Requirements)

### 買家 (學弟) 檢索與篩選

| 編號 | 需求描述 | 備註 |
| :--- | :--- | :--- |
| **FR-BS-001** | **關鍵字搜尋：** 支援透過書名、作者、ISBN 進行模糊或精確的關鍵字搜尋。 | 必須支援 |
| **FR-BS-002** | **多維度搜尋：** 支援透過**對應課程名稱**和**授課老師姓名**進行檢索，滿足學弟在忘記書名時仍能找到書籍的需求。 | 滿足學弟需求。 |
| **FR-BS-003** | **篩選功能：** 支援根據書籍的新舊程度、價格範圍、交易方式（面交/郵寄）進行結果篩選。 | 必須支援 |

### 系統結果呈現與排序

| 編號 | 需求描述 | 備註 |
| :--- | :--- | :--- |
| **FR-BS-004** | **加權排序：** 搜尋結果必須能夠根據**相關性 (Relevance)** 進行排序，其中書籍名稱和 ISBN 的匹配權重應高於課程或老師名稱。 | 必須支援 |
| **FR-BS-005** | **排序選項：** 支援使用者根據 **價格（高到低/低到高）** 和 **刊登時間（最新）** 進行排序。 | 必須支援 |
| **FR-BS-006** | **結果預覽：** 搜尋結果列表必須提供**關鍵資訊預覽**（例如：價格、新舊程度簡述），幫助買家快速判斷。 | 滿足學弟「進行試閱」的初始判斷。 |

---
## 3. 🛡️ 非功能性需求 (Non-Functional Requirements)

| 編號 | 需求類別 | 需求描述 |
| :--- | :--- | :--- |
| **NFR-BS-P-001** | **效能 (速度)** | 95% 的搜尋請求必須在 **500 毫秒 (ms)** 內返回結果列表。 |
| **NFR-BS-S-001** | **安全性** | 搜尋 API 接口必須限制外部直接訪問，所有查詢都必須經過應用程式服務器進行驗證和清理，防止惡意查詢。 |
| **NFR-BS-A-001** | **可用性 (準確性)** | 搜尋結果必須與實際庫存狀態保持**一致**，已售出或下架的書籍不應出現在搜尋結果中。 |
| **NFR-BS-E-001** | **可擴展性** | 系統設計必須能夠應對書籍數量擴展到未來更大規模的需求，搜尋性能不應顯著下降。 |

---
## 4. 測試與驗收標準 (Acceptance Criteria)

這些標準直接對應設計文件中的測試項目，用於驗收搜尋功能是否符合要求。

| 編號 | 驗收描述 | 依據 |
| :--- | :--- | :--- |
| **AC-BS-001** | 驗證搜尋功能是否**正常運作**，能在可忍受時間內（<500ms）將相關書籍呈現給買家。 | 原始測試項目 `2.` |
| **AC-BS-002** | 驗證搜尋導覽（篩選器、排序選項）是否**正常運作**，可供買家使用多種方式獲取書籍。 | 原始測試項目 `3.` |
| **AC-BS-003** | 驗證當使用者輸入關鍵字，系統返回結果的**加權排序**是否符合預期設計（例如：書名匹配應排在最前面）。 | FR-BS-004 |
| **AC-BS-004** | 驗證已標記為**「已售出」**的書籍是否會被排除在搜尋結果之外。 | NFR-BS-A-001 |

---
## 5. 💰 系統限制：收費機制 (System Constraints: Fee Mechanism)

平台必須實施交易收費機制，以支持營運和服務維護。

| 限制類型 | 限制內容 | 技術設計影響 |
| :--- | :--- | :--- |
| **CON-BS-001** | **交易佣金：** 系統將向**賣家**收取每筆成功交易金額的 **5%** 作為平台服務費。 | 需設計金流結算模組自動計算和扣除費用。 |
| **CON-BS-002** | **最低收費額：** 若計算出的佣金低於新台幣 **10 元**，則統一收取 **10 元**。 | 金流計算邏輯必須為：**費用 = MAX (10, 交易總額 \* 0.05)**。 |
| **CON-BS-003** | **收費通知：** 每次交易完成和佣金結算時，系統必須向賣家發送清晰的**收費明細通知**。 | 需整合通知服務（Email/站內信）來觸發結算報告。 |
